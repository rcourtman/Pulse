# Block pushing version tags directly â€” releases must go through the GitHub Actions workflow
# (workflow_dispatch on create-release.yml). Pushing tags manually bypasses the release
# pipeline which builds binaries, Docker images, and validates assets.
while read local_ref local_sha remote_ref remote_sha; do
    if echo "$local_ref" | grep -qE "^refs/tags/v[0-9]"; then
        echo ""
        echo "BLOCKED: Direct push of version tag '${local_ref#refs/tags/}' is not allowed."
        echo ""
        echo "  Releases must be created via the GitHub Actions release workflow:"
        echo "    gh workflow run create-release.yml -f version=X.Y.Z -f release_notes=\"...\""
        echo ""
        echo "  Pushing tags directly skips the build pipeline and publishes a broken release"
        echo "  with no binaries, no Docker images, and no checksums."
        echo ""
        exit 1
    fi
done

# TypeScript type-check before push to prevent CI failures
cd frontend-modern && npm run type-check
